---
title: "graphs"
output: html_document
date: "2022-11-22"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(plotly)
```

```{r message=FALSE, warning=FALSE}
setwd("C:/Users/Anna/Desktop/Hertie/second_year/GHG-project")
owid <- read_csv("owid-co2-data.csv")
```

Which states contribute to production-based emissions and consumption-based emissions the most? Are these the same states? What are the differences?
How does this change when we look at the regions? Which regions contribute the most? 
What are the differences in share between states with the highest and lowest GDP (per capita)?

```{r}
figure_1 <- owid %>% filter(!is.na(consumption_co2))%>% filter(country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia", "Australia", "Asia (excl. China & India)", "European Union (28)", "North America (excl. USA)", "Oceania"))%>%
  filter(year==2019) %>% 
  arrange(desc(consumption_co2)) %>% 
  ggplot(.,aes(x=consumption_co2,y=reorder(country,consumption_co2))) +
  geom_col(color="#636363",fill="#BD1550") +
  scale_fill_brewer(palette="Set2") +
  theme_bw() +
  theme(axis.title.y = element_blank()) +
  xlab("") +
  ggtitle("Consumption of CO2 per region in 2019")+guides(fill=guide_legend(title=" "))
```

```{r}
figure_2 <- owid %>% filter(!is.na(cumulative_co2))%>% filter(country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia", "Australia", "Asia (excl. China & India)", "European Union (28)", "North America (excl. USA)", "Oceania"))%>%
  filter(year==2019) %>% 
  arrange(desc(cumulative_co2)) %>% 
  ggplot(.,aes(x=cumulative_co2,y=reorder(country,cumulative_co2))) +
  geom_col(color="#636363",fill="#490A3D") +
  theme_bw() +
  theme(axis.title.y = element_blank()) +
  xlab("") +
  ggtitle("Production of CO2 per region in 2019")+guides(fill=guide_legend(title=" "))
```

```{r message=FALSE, warning=FALSE}
figure_3<-owid %>% 
  filter(country %in% c( "Africa", "North America", "Europe", "South America", "Asia", "Australia", "Asia (excl. China & India)", "North America (excl. USA)", "Oceania")) %>% 
  ggplot(.,aes(x=year,y=consumption_co2,fill=country)) +
  geom_area(color="#636363", position="fill") +
  theme_bw() +
  scale_fill_brewer(palette="RdPu") +
  ylab("") +
  theme(axis.title.x=element_blank()) +
  ggtitle(paste0("Share of CO2 consumption across regions since 1990"))+guides(fill=guide_legend(title=" "))
```

```{r}

figure_4<-owid %>% filter(year>1990 )%>%
  filter(country %in% c("Africa", "North America", "Europe", "South America", "Asia", "Australia", "Asia (excl. China & India)", "North America (excl. USA)", "Oceania")) %>% 
  ggplot(.,aes(x=year,y=cumulative_co2,fill=country)) +
  geom_area(color="#636363", position="fill") +
  theme_bw() +
  scale_fill_brewer(palette="BuPu") +
  ylab("") +
  theme(axis.title.x=element_blank()) +
  ggtitle(paste0("Share of CO2 production across regions since 1990"))+guides(fill=guide_legend(title=" "))
```

```{r message=FALSE, warning=FALSE}
figure_1
figure_2
figure_3
figure_4

```


```{r}
figure_5 <- owid %>% filter(!is.na(consumption_co2))%>% filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia", "Australia", "Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries", "North America (excl. USA)","Oceania" ))%>%
  filter(year==2019) %>% 
  arrange(desc(consumption_co2)) %>% 
  head(10) %>% 
  ggplot(.,aes(x=consumption_co2,y=reorder(country,consumption_co2))) +
  geom_col(color="#636363",fill="#BD1550") +
  scale_fill_brewer(palette="Set2") +
  theme_bw() +
  theme(axis.title.y = element_blank()) +
  xlab("") +
  ggtitle("Consumption of CO2 per country in 2019")
```

```{r}
figure_6 <- owid %>% filter(!is.na(consumption_co2))%>% filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia", "Australia", "Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries", "North America (excl. USA)",  "Oceania" ))%>%
  filter(year==2019) %>% 
  arrange(desc(cumulative_co2)) %>% 
  head(10) %>% 
  ggplot(.,aes(x=cumulative_co2,y=reorder(country,cumulative_co2))) +
  geom_col(color="#636363",fill="#490A3D") +
  theme_bw() +
  theme(axis.title.y = element_blank()) +
  xlab("") +
  ggtitle("Production of CO2 per country in 2019")
```


```{r}
figure_5
figure_6

```

```{r message=FALSE, warning=FALSE}
figure_7<-owid %>% filter(year>1990)%>%
  filter(country %in% c( "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries", "Low-income countries")) %>% 
  ggplot(.,aes(x=year,y=consumption_co2,fill=country)) +
  geom_area(color="#636363", position="fill") +
  theme_bw() +
  scale_fill_brewer(palette="RdPu") +
  ylab("") +
  theme(axis.title.x=element_blank()) +
  ggtitle(paste0("Share of CO2 consumption across by income"))+guides(fill=guide_legend(title=" "))



figure_8<-owid %>% filter(year>1990)%>%
  filter(country %in% c( "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries", "Low-income countries")) %>% 
  ggplot(.,aes(x=year,y=cumulative_co2,fill=country)) +
  geom_area(color="#636363", position="fill") +
  theme_bw() +
  scale_fill_brewer(palette="RdPu") +
  ylab("") +
  theme(axis.title.x=element_blank()) +
  ggtitle(paste0("Share of CO2 production by income"))+guides(fill=guide_legend(title=" "))
```

```{r message=FALSE, warning=FALSE}
figure_7
figure_8
```


```{r}
owid%>%filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia", "Australia", "Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries", "North America (excl. USA)", "Oceania")) %>%filter(year==2018)%>%  arrange(desc(cumulative_co2)) %>% 
  head(20) %>% plot_ly( x = ~cumulative_co2, y = ~consumption_co2, type = 'scatter', mode = 'markers', size = ~gdp, color = ~country, colors = 'Paired',
        sizes = c(50, 1000))
```

```{r}
library(countrycode)
owid_bubbles<- owid %>%  filter(!is.na(country))%>%
  mutate(continent = countrycode(iso_code, origin = "iso3c", destination = "continent"))


#filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia", "Australia", "Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries", "North America (excl. USA)", "Oceania"))%>%
```
