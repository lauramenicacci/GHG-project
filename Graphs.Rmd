---
title: "graphs"
output: html_document
date: "2022-11-22"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(plotly)
library(countrycode)
```

```{r message=FALSE, warning=FALSE}
#setwd("C:/Users/Anna/Desktop/Hertie/second_year/GHG-project")
owid <- read_csv("data/owid-co2-data.csv")
```

Which states contribute to production-based emissions and consumption-based emissions the most? Are these the same states? What are the differences?
How does this change when we look at the regions? Which regions contribute the most? 
What are the differences in share between states with the highest and lowest GDP (per capita)?

```{r}
owid <-owid%>%mutate(gdp_per_capita=gdp/population)
owid<-owid%>%filter(!country %in% c("International transport", "Kuwaiti Oil Fires"))
owid<-owid%>%mutate(continent = countrycode(iso_code, origin = "iso3c", destination = "continent"))
```

```{r}
figure_1 <- owid %>% 
  filter(!is.na(consumption_co2))%>% filter(country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia", "Australia", "Asia (excl. China & India)", "European Union (28)", "North America (excl. USA)", "Oceania", "Antarctica"))%>%
  filter(year==2018) %>% 
  arrange(desc(consumption_co2)) %>% 
  ggplot(.,aes(x=consumption_co2,y=reorder(country,consumption_co2))) +
  geom_col(color="#636363",fill="#BD1550") +
  scale_fill_brewer(palette="Set2") +
  theme_bw() +
  theme(axis.title.y = element_blank()) +
  xlab("") +
  ggtitle("Consumption of CO2 per Region in 2018")+guides(fill=guide_legend(title=" "))

ggsave("pics/Fig. 1 Consumption by Region 2018", plot = figure_1, device = "png", width = 10, height = 8)
```

```{r}
figure_2 <- owid %>% filter(!is.na(co2))%>% filter(country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia", "Australia", "Asia (excl. China & India)", "European Union (28)", "North America (excl. USA)", "Oceania", "Antarctica"))%>%
  filter(year==2018) %>% 
  arrange(desc(co2)) %>% 
  ggplot(.,aes(x=co2,y=reorder(country,co2))) +
  geom_col(color="#636363",fill="#490A3D") +
  theme_bw() +
  theme(axis.title.y = element_blank()) +
  xlab("") +
  ggtitle("Production of CO2 per Region in 2018")+guides(fill=guide_legend(title=" "))

ggsave("pics/Fig. 2 Production by Region 2018", plot = figure_2, device = "png", width = 10, height = 8)
```

```{r message=FALSE, warning=FALSE}
figure_3 <- owid %>% 
  filter(country %in% c("Africa", "North America", "Europe", "South America", "Asia", "Australia", "Asia (excl. China & India)", "North America (excl. USA)", "Oceania", "Antarctica")) %>% filter(year>=1990 & year<=2018) %>%
  ggplot(.,aes(x=year,y=consumption_co2,fill=country)) +
  geom_area(color="#636363", position="fill") +
  theme_bw() +
  scale_fill_brewer(palette="RdPu") +
  ylab("") +
  theme(axis.title.x=element_blank()) +
  ggtitle(paste0("Share of CO2 Consumption across Regions since 1990"))+guides(fill=guide_legend(title=" "))

ggsave("pics/Fig. 3 share of consumption by region s1990", plot = figure_3, device = "png", width = 10, height = 8)
```

```{r}
figure_4 <- owid %>% filter(year>=1990 & year<=2018) %>%
  filter(country %in% c("Africa", "North America", "Europe", "South America", "Asia", "Australia", "Asia (excl. China & India)", "North America (excl. USA)", "Oceania", "Antarctica")) %>% 
  ggplot(.,aes(x=year,y=co2,fill=country)) +
  geom_area(color="#636363", position="fill") +
  theme_bw() +
  scale_fill_brewer(palette="BuPu") +
  ylab("") +
  theme(axis.title.x=element_blank()) +
  ggtitle(paste0("Share of CO2 Production across Regions since 1990"))+guides(fill=guide_legend(title=" "))

ggsave("pics/Fig. 4 share of production by region s1990", plot = figure_4, device = "png", width = 10, height = 8)
```

```{r message=FALSE, warning=FALSE}
figure_1
figure_2
figure_3
figure_4
```


```{r}
figure_5 <- owid %>% filter(!is.na(consumption_co2))%>% filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia", "Australia", "Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries", "North America (excl. USA)","Oceania", "Antarctica"))%>%
  filter(year==2018) %>% 
  arrange(desc(consumption_co2)) %>% 
  head(10) %>% 
  ggplot(.,aes(x=consumption_co2,y=reorder(country,consumption_co2))) +
  geom_col(color="#636363",fill="#BD1550") +
  scale_fill_brewer(palette="Set2") +
  theme_bw() +
  theme(axis.title.y = element_blank()) +
  xlab("") +
  ggtitle("Consumption of CO2 per country in 2018")

ggsave("pics/Fig. 5 consumption by country 2018", plot = figure_5, device = "png", width = 10, height = 8)
```

```{r}
figure_6 <- owid %>% filter(!is.na(co2)) %>% 
  filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia", "Australia", "Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries", "North America (excl. USA)",  "Oceania", "Antarctica")) %>%
  filter(year==2018) %>% 
  arrange(desc(co2)) %>% 
  head(10) %>% 
  ggplot(.,aes(x=co2,y=reorder(country,co2))) +
  geom_col(color="#636363",fill="#490A3D") +
  theme_bw() +
  theme(axis.title.y = element_blank()) +
  xlab("") +
  ggtitle("Production of CO2 per country in 2018")

ggsave("pics/Fig. 6 production by country 2018", plot = figure_6, device = "png", width = 10, height = 8)
```


```{r}
figure_5
figure_6
```

```{r message=FALSE, warning=FALSE}
figure_7 <- owid %>% filter(year>=1990 & year<=2018) %>%
  filter(country %in% c( "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries", "Low-income countries")) %>% 
  ggplot(.,aes(x=year,y=consumption_co2,fill=country)) +
  geom_area(color="#636363", position="fill") +
  theme_bw() +
  scale_fill_brewer(palette="RdPu") +
  ylab("") +
  theme(axis.title.x=element_blank()) +
  ggtitle(paste0("Share of consumption based CO2 emissions by income  1990-2018"))+guides(fill=guide_legend(title=" "))

ggsave("pics/Fig. 7 consumption by income s1990", plot = figure_7, device = "png", width = 10, height = 8)

figure_8 <- owid %>% filter(year>=1990 & year<=2018) %>%
  filter(country %in% c("High-income countries", "Upper-middle-income countries", "Lower-middle-income countries", "Low-income countries")) %>% 
  ggplot(.,aes(x=year,y=co2,fill=country)) +
  geom_area(color="#636363", position="fill") +
  theme_bw() +
  scale_fill_brewer(palette="BuPu") +
  ylab("") +
  theme(axis.title.x=element_blank()) +
  ggtitle(paste0("Share of CO2 production based CO2 emissions by income 1990-2018"))+guides(fill=guide_legend(title=" "))

ggsave("pics/Fig. 8 production by income s1990", plot = figure_8, device = "png", width = 10, height = 8)
```

```{r message=FALSE, warning=FALSE}
figure_7
figure_8
```

```{r}
figure_9 <- owid%>% filter(!is.na(country))%>% filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia","Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries", "North America (excl. USA)", "Oceania", "Antarctica")) %>%filter(year==2018) %>%  filter(!is.na(gdp_per_capita)&!is.na(co2)&!is.na(consumption_co2))%>%arrange(desc(gdp_per_capita)) %>% 
  head(12) %>% plot_ly( x = ~co2, y = ~consumption_co2, type = 'scatter', mode = 'markers', size = ~gdp_per_capita, color = ~country, colors = 'Paired',
        sizes = c(50, 1000))

figure_9 <- figure_9 %>%
  layout(title = 'Consumption vs production based emissions (top 12 by GDP per capita)',
         xaxis = list(title = 'Production of CO2 in million tonnes'), 
         yaxis = list(title = 'Consumption of CO2 in million tonnes'))%>%  
  layout(showlegend = FALSE)

htmlwidgets::saveWidget(figure_9, file = "pics/figure_9.html")
figure_9
```



```{r message=FALSE, warning=FALSE}
figure_10 <- owid%>% filter(!is.na(country))%>% filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia","Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries", "North America (excl. USA)", "Oceania", "Antarctica"))%>%
  filter(year==2018) %>%
  filter(!is.na(gdp_per_capita)&!is.na(co2)&!is.na(consumption_co2)) %>%
  arrange(desc(gdp_per_capita)) %>% 
  slice_min(gdp_per_capita,n=12) %>% 
  plot_ly( x = ~co2, y = ~consumption_co2, type = 'scatter', mode = 'markers', size = ~gdp_per_capita, color = ~country, colors = 'Paired',
        sizes = c(50, 1000))

figure_10  <- figure_10  %>%
  layout(title = 'Consumption vs production based emissions (bottom 12 by GDP per capita)',
         xaxis = list(title = 'Production of CO2 in million tonnes'), yaxis = list(title = 'Consumption of CO2 in million tonnes'))
figure_10
htmlwidgets::saveWidget(figure_10, file = "pics/figure_10.html")
```

Production analysis

```{r}
owid %>% filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia","Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries","Low-income countries", "North America (excl. USA)", "Oceania", "Antarctica"))%>% filter(year ==2018)%>% 
  select(country, continent, co2_per_capita) %>% arrange(desc(co2_per_capita))

```
```{r}
owid %>% filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia","Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries","Low-income countries", "North America (excl. USA)", "Oceania", "Antarctica"))%>% filter(year ==2018)%>% 
  select(country, continent, co2_per_gdp) %>% arrange(desc(co2_per_gdp))

```
```{r}
owid %>% filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia","Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries","Low-income countries", "North America (excl. USA)", "Oceania", "Antarctica"))%>% filter(year ==2018)%>% 
  select(country, continent, co2, gdp_per_capita) %>% mutate(co2_per_gdp_per_capita=co2/gdp_per_capita)%>%arrange(desc(co2_per_gdp_per_capita))
```

```{r}
#cumulative production of CO2 emissions between 1990 and 2018 per country
owid %>% filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia","Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries","Low-income countries", "North America (excl. USA)", "Oceania", "Antarctica"))%>% filter(year %in% c(1990, 2018))%>% select(country, year, cumulative_co2, continent)%>% pivot_wider(names_from = year, values_from = cumulative_co2)%>%mutate(diff=`2018`-`1990`)%>% filter(!is.na(`2018`) & !is.na(`1990`)) %>% arrange(desc(diff))
```
```{r}
#perc is a number that represents the share in their respective continents' emission that countries had between 1990 and 2018
owid %>% filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia","Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries","Low-income countries", "North America (excl. USA)", "Oceania", "Antarctica"))%>% filter(year %in% c(1990, 2018))%>% select(country, year, cumulative_co2, continent)%>% pivot_wider(names_from = year, values_from = cumulative_co2)%>%mutate(diff=`2018`-`1990`)%>%arrange(desc(diff))%>% filter(!is.na(`2018`) & !is.na(`1990`))%>%group_by(continent, country)%>%summarise(cnt = sum(diff, na.rm=T)) %>%
  mutate(perc = (round(cnt / sum(cnt), 2))*100)%>% arrange(desc(perc))
```

```{r}
#perc is a number that represents the share in the Asia's emission that country had between 1990 and 2018 
owid %>% filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia","Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries","Low-income countries", "North America (excl. USA)", "Oceania", "Antarctica"))%>% filter(year %in% c(1990, 2018))%>% select(country, year, cumulative_co2, continent)%>% pivot_wider(names_from = year, values_from = cumulative_co2)%>%mutate(diff=`2018`-`1990`)%>%arrange(desc(diff))%>% filter(!is.na(`2018`) & !is.na(`1990`))%>%group_by(continent, country)%>%summarise(cnt = sum(diff, na.rm=T)) %>%
  mutate(perc = (round(cnt / sum(cnt), 2))*100)%>% arrange(desc(perc))%>%filter(continent=="Asia")
```

```{r}
#perc is a number that represents the share in Africa's emission that each country had between 1990 and 2018
owid %>% filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia","Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries","Low-income countries", "North America (excl. USA)", "Oceania", "Antarctica"))%>% filter(year %in% c(1990, 2018))%>% select(country, year, cumulative_co2, continent)%>% pivot_wider(names_from = year, values_from = cumulative_co2)%>%mutate(diff=`2018`-`1990`)%>%arrange(desc(diff))%>% filter(!is.na(`2018`) & !is.na(`1990`))%>%group_by(continent, country)%>%summarise(cnt = sum(diff, na.rm=T)) %>%
  mutate(perc = (round(cnt / sum(cnt), 2))*100)%>% arrange(desc(perc))%>%filter(continent=="Africa")
```

```{r}
#Average Annual (Compound) Growth Rates in % of CO2 production per country in the time range 1990-2018
owid %>% filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia","Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries","Low-income countries", "North America (excl. USA)", "Oceania", "Antarctica"))%>% filter(year %in% c(1990, 2018))%>% select(country, year, co2, continent)%>% pivot_wider(names_from = year, values_from = co2)%>% filter(!is.na(`2018`) & !is.na(`1990`)) %>% mutate(`avg_growth_rate(%)`=(((`2018`/`1990`)^(1/(2018-1990))-1))*100)%>%arrange(desc(`avg_growth_rate(%)`))
```

```{r}
#Average Annual (Compound) Growth Rates in % of CO2 production per capita in the time range 1990-2018

df_base<-owid %>% filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia","Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries","Low-income countries", "North America (excl. USA)", "Oceania", "Antarctica"))%>% filter(year %in% c(1990, 2018))%>% select(country, year, co2, continent)%>% pivot_wider(names_from = year, values_from = co2)%>% filter(!is.na(`2018`) & !is.na(`1990`))

df_population<-owid%>%select(population, country, year)%>%filter(year %in% c(1990, 2018))%>%pivot_wider(names_from = year, values_from = population)
df_production_relative<-left_join(df_base, df_population, by="country")

df_production_relative<-df_production_relative%>%
  mutate(`avg_growth_rate_pcapita(%)`=(((`2018.x`/`2018.y`)/(`1990.x`/`1990.y`))^(1/(2018-1990))-1)*100) %>%
  rename(pop_18=`2018.y`)%>% rename(pop_90=`1990.y`)%>%rename(emiss_18=`2018.x`)%>%rename(emiss_90=`1990.x`)%>% arrange(desc(`avg_growth_rate_pcapita(%)`))


df_production_relative
```

```{r}
#the cumulative growth over time
owid %>% filter(country %in% c("High-income countries", "Upper-middle-income countries", "Lower-middle-income countries","Low-income countries"))%>% filter(year %in% c(1990, 2018))%>% select(country, year, cumulative_co2)%>% pivot_wider(names_from = year, values_from = cumulative_co2)%>%mutate(diff=(`2018`-`1990`))%>%arrange(desc(diff))%>% filter(!is.na(`2018`) & !is.na(`1990`))
```

```{r}
#Average Annual (Compound) Growth Rates in % of CO2 production per income group in the time range 1990-2018
owid %>% filter(country %in% c("High-income countries", "Upper-middle-income countries", "Lower-middle-income countries","Low-income countries"))%>% filter(year %in% c(1990, 2018))%>% select(country, year, co2)%>% pivot_wider(names_from = year, values_from = co2)%>%mutate(`avg_growth_rate(%)`=(((`2018`/`1990`)^(1/(2018-1990))-1))*100) %>%arrange(desc(`avg_growth_rate(%)`))%>% filter(!is.na(`2018`) & !is.na(`1990`))
```

```{r}
#Average Annual (Compound) Growth Rates in % of CO2 production per gdp in the time range 1990-2018
df_gdp<-owid%>%select(gdp, country, year)%>%filter(year %in% c(1990, 2018))%>%pivot_wider(names_from = year, values_from = gdp)
df_production_gdp<-left_join(df_base, df_gdp, by="country")

df_production_gdp<-df_production_gdp%>%
  mutate(`avg_growth_rate_gdp(%)`=((((`2018.x`/`2018.y`)/(`1990.x`/`1990.y`))^(1/(2018-1990))-1))*100)%>%
  rename(gdp_18=`2018.y`)%>% rename(gdp_90=`1990.y`)%>%rename(emiss_18=`2018.x`)%>%rename(emiss_90=`1990.x`)%>% arrange(desc(`avg_growth_rate_gdp(%)`))


df_production_gdp
```

```{r}
#Average Annual (Compound) Growth Rates in % of CO2 production per gdp per capita in the time range 1990-2018

df_gdp_cap<-owid%>%select(gdp_per_capita, country, year)%>%filter(year %in% c(1990, 2018))%>%pivot_wider(names_from = year, values_from = gdp_per_capita)
df_production_gdp_cap<-left_join(df_base, df_gdp_cap, by="country")

df_production_gdp_cap<-df_production_gdp_cap%>%
  mutate(`avg_growth_rate_gdp_pcapita(%)`=((((`2018.x`/`2018.y`)/(`1990.x`/`1990.y`))^(1/(2018-1990))-1))*100)%>%
  rename(gdpcap_18=`2018.y`)%>% rename(gdpcap_90=`1990.y`)%>%rename(emiss_18=`2018.x`)%>%rename(emiss_90=`1990.x`)%>% arrange(desc(`avg_growth_rate_gdp_pcapita(%)`))


df_production_gdp_cap
```



CONSUMPTION

```{r}
#fastest growing countries in terms of consumption in absolute terms
df_consumption_base<-owid %>% filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia","Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries","Low-income countries", "North America (excl. USA)", "Oceania", "Antarctica"))%>%select(country, year, consumption_co2, continent)%>%filter(year %in% 1990:2018)%>%group_by(country)%>%filter(!is.na(consumption_co2))%>%summarise(total=cumsum(consumption_co2))%>%
  summarise(diff = max(total, na.rm=TRUE))%>%arrange(desc(diff))

df_consumption_base 
```

```{r}
#Average Annual (Compound) Growth Rates in % of CO2 consumption per country in the time range 1990-2018
owid %>% filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia","Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries","Low-income countries", "North America (excl. USA)", "Oceania", "Antarctica"))%>%select(country, year, consumption_co2)%>%filter(year %in% c(1990, 2018))%>% pivot_wider(names_from = year, values_from = consumption_co2)%>% 
  filter(!is.na(`2018`) & !is.na(`1990`))%>%mutate(`avg_growth_rate(%)`=(((`2018`/`1990`)^(1/(2018-1990))-1))*100)%>%arrange(desc(`avg_growth_rate(%)`))
```

```{r}
#Average Annual (Compound) Growth Rates in % of CO2 consumption per gdp in the time range 1990-2018
df_base_consumption<-owid %>% filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia","Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries","Low-income countries", "North America (excl. USA)", "Oceania", "Antarctica"))%>% filter(year %in% c(1990, 2018))%>% select(country, year, consumption_co2, continent)%>% pivot_wider(names_from = year, values_from = consumption_co2)%>% filter(!is.na(`2018`) & !is.na(`1990`))


df_consumption_gdp <- left_join(df_base_consumption, df_gdp, by="country")

df_consumption_gdp<-df_consumption_gdp%>%
  mutate(`avg_growth_rate_gdp(%)`=((((`2018.x`/`2018.y`)/(`1990.x`/`1990.y`))^(1/(2018-1990))-1))*100)%>%
  rename(gdp_18=`2018.y`)%>% rename(gdp_90=`1990.y`)%>%rename(emiss_18=`2018.x`)%>%rename(emiss_90=`1990.x`)%>% arrange(desc(`avg_growth_rate_gdp(%)`))


df_consumption_gdp
```

```{r}
#Average Annual (Compound) Growth Rates in % of CO2 consumption per gdp per capita
df_consumption_gdp_cap<-left_join(df_base_consumption, df_gdp_cap, by="country")

df_consumption_gdp_cap<-df_consumption_gdp_cap%>%
  mutate(`avg_growth_rate_gdp_pcapita(%)`=(((`2018.x`/`2018.y`)/(`1990.x`/`1990.y`))^(1/(2018-1990))-1)*100)%>%
  rename(gdpcap_18=`2018.y`)%>% rename(gdpcap_90=`1990.y`)%>%rename(emiss_18=`2018.x`)%>%rename(emiss_90=`1990.x`)%>% arrange(desc(`avg_growth_rate_gdp_pcapita(%)`))


df_consumption_gdp_cap
```

```{r}
#Average Annual (Compound) Growth Rates in % of CO2 consumption per capita in the time range 1990-2018

df_consumption_relative<-left_join(df_base_consumption, df_population, by="country")

df_consumption_relative<-df_consumption_relative%>%
  mutate(`avg_growth_rate_pcapita(%)`=(((`2018.x`/`2018.y`)/(`1990.x`/`1990.y`))^(1/(2018-1990))-1)*100)%>%
  rename(pop_18=`2018.y`)%>% rename(pop_90=`1990.y`)%>%rename(emiss_18=`2018.x`)%>%rename(emiss_90=`1990.x`)%>% arrange(desc(`avg_growth_rate_pcapita(%)`))


df_consumption_relative
```

CONSUMPTION VS. PRODUCTION

absolute difference:
```{r}
df_diff <- owid %>% filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia","Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries","Low-income countries", "North America (excl. USA)", "Oceania", "Antarctica"))%>%select(country, continent, year, consumption_co2,co2)%>% filter(year==2018)%>% filter(!is.na(consumption_co2) & !is.na(co2))%>%mutate(abs_diff=abs(consumption_co2-co2))%>%arrange(desc(abs_diff))
```

relative difference:
```{r}
df_ratio <- df_diff %>% 
  filter(!country %in% c("World", "Africa", "North America", "Europe (excl. EU-28)", "South America", "Asia","Asia (excl. China & India)", "European Union (28)", "Europe","Europe (excl. EU-27)", "European Union (27)", "High-income countries", "Upper-middle-income countries", "Lower-middle-income countries","Low-income countries", "North America (excl. USA)", "Oceania", "Antarctica")) %>%
  select(country, continent, year, consumption_co2, co2, abs_diff) %>% 
  filter(year == 2018) %>% 
  filter(!is.na(consumption_co2) & !is.na(co2)) %>%
  mutate(ratio_pb_cb = consumption_co2/co2)

#the resulting ratio from the latest data point we have (2018) will be used to linearly predict the consumption based emissions
```



